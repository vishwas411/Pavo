let accountsForDomain={};const isChrome=!window.hasOwnProperty("browser"),platform=isChrome?chrome:browser;platform.tabs.onUpdated.addListener((t,e,o)=>{"loading"===e.status&&updateAvailibleCredentials(o.url)}),isChrome?chrome.tabs.onActiveChanged.addListener(t=>{chrome.tabs.get(t,t=>{updateAvailibleCredentials(t.url)})}):browser.tabs.onActivated.addListener(t=>{browser.tabs.get(t.tabId).then(t=>{updateAvailibleCredentials(t.url)})});const updateAvailibleCredentials=t=>{/(chrome|about):\/\/.*/.test(t)||/about:.*/.test(t)?platform.browserAction.setBadgeText({text:""}):chrome.storage.local.get(["badge"],e=>{if(!0===e.badge){const e=getUrlDomain(t);if(accountsForDomain[e])return void platform.browserAction.setBadgeText({text:0===accountsForDomain[e]?"":String(accountsForDomain[e])});platform.browserAction.setBadgeText({text:""}),fetch("http://bugmenot.com/view/"+e).then(t=>t.text()).then(t=>{let o=document.createElement("div");o.innerHTML=t;const a=(o=o.querySelector("#content")).getElementsByClassName("account").length;accountsForDomain[e]=a,platform.browserAction.setBadgeText({text:0===a?"":String(a)})})}})};