$(()=>{(new function(){let e,t;e=void 0;this.init=(()=>{document.querySelector("#header > h2").innerHTML=chrome.i18n.getMessage("name").split(" -")[0]+":&nbsp;",document.querySelector("#header > h1").innerHTML=chrome.i18n.getMessage("inbox"),n(),i()});let n=()=>{chrome.runtime.sendMessage({action:"resetNewMails"})},i=()=>{EXT_helper.callApi("getInbox",{}).then(({success:e,inactive:t,mails:n,email:i,lifetime:c})=>{t?a():e?s(n,i,c):_contentForError()})},a=()=>{let e=document.createElement("div"),t=document.createElement("button"),n=document.createElement("p");t.innerHTML='<i class="icofont-magic"></i>Get Mail',n.innerHTML=chrome.i18n.getMessage("popup_get_address_hint"),e.classList.add("create"),e.appendChild(t),e.appendChild(n),document.querySelector("#inbox").appendChild(e),t.addEventListener("click",()=>{EXT_helper.callApi("getAddress",{}).then(({ukey:e,email:t})=>{if(!e)return!1;chrome.storage.local.set({ukey:e},()=>{chrome.runtime.sendMessage({action:"setInboxPolling",state:!0}),location.reload()})})})},s=(e,n,i)=>{t=i,t=451;let a=()=>{if(t>=1){t--;let e=String(parseInt(t/60)).padStart(2,"0"),n=String(t-60*e).padStart(2,"0");document.querySelector("#lifetime > span").innerText=e+":"+n,document.querySelector("#lifetime").classList.remove("hidden")}else document.querySelector("#lifetime .badge").classList.add("hidden")};t=451,a(),window.setInterval(a,1e3),t=451;let s=document.querySelector("#lifetime .badge");s.innerHTML='<i class="icofont-ui-add"></i> '+chrome.i18n.getMessage("extend_short"),s.addEventListener("mouseout",()=>{s.classList.remove("used"),s.innerHTML='<i class="icofont-ui-add"></i> '+chrome.i18n.getMessage("extend_short")}),s.addEventListener("click",()=>{s.classList.contains("used")||(s.classList.add("used"),s.innerHTML='<i class="icofont-ui-check pen"></i> '+chrome.i18n.getMessage("extended_short"),EXT_helper.callApi("getAddress",{}).then(({success:e,inactive:n,mails:i,email:s,lifetime:c})=>{t=c+1,a()}))});let c=document.createElement("span");if(c.innerHTML='<i class="icofont-ui-copy"></i> '+chrome.i18n.getMessage("copy"),c.classList.add("badge"),c.addEventListener("mouseout",()=>{c.classList.remove("used"),c.innerHTML='<i class="icofont-ui-copy"></i> '+chrome.i18n.getMessage("copy")}),c.addEventListener("click",()=>{if(!c.classList.contains("used")){var e=document.createElement("input");document.querySelector("body").appendChild(e),e.value=n,e.select(),document.execCommand("copy")&&(c.classList.add("used"),c.innerHTML='<i class="icofont-ui-check pen"></i> '+chrome.i18n.getMessage("copied")),e.parentElement.removeChild(e)}}),document.querySelector("#email").innerHTML=n,document.querySelector("#email").appendChild(c),0==e.length){let e=document.createElement("div"),t=["owl","squirrel","pig","monkey-face","seal","cow","butterfly","elephant-alt","bear-face","giraffe-head","penguin","panda","pelican"];e.classList.add("empty"),e.innerHTML='<i class="icofont-'+t[Math.round(Math.random()*(t.length-1))]+'"></i>'+chrome.i18n.getMessage("popup_inbox_empty"),document.querySelector("#inbox").appendChild(e)}for(let t of e){let e=document.createElement("div"),n=document.createElement("div"),i=document.createElement("button"),a=document.createElement("div"),s=document.createElement("div"),c=document.createElement("div"),d=document.createElement("div"),o=document.createElement("iframe");if(e.classList.add("item"),n.classList.add("attachments"),i.classList.add("header"),a.classList.add("subject"),s.classList.add("title"),c.classList.add("from"),d.classList.add("date"),o.classList.add("body"),t.new&&a.classList.add("new"),s.innerText=t.subject,c.innerText=t.from,d.innerHTML=t.date.replace(", ","<br/>"),o.onload=(()=>{o.contentWindow.document.open(),o.contentWindow.document.write(t.body),o.contentWindow.document.close()}),o.src="about:blank",a.appendChild(s),a.appendChild(c),i.appendChild(a),i.appendChild(d),e.appendChild(i),t.attachments&&t.attachments.length>0){e.classList.add("has-attachments");for(let e of t.attachments){let t=document.createElement("a");t.href=e.url,t.innerText=e.name,t.target="blank",n.appendChild(t)}e.appendChild(n)}e.appendChild(o),document.querySelector("#inbox").appendChild(e)}let d=document.querySelectorAll("#inbox > .item > .header");d.forEach(e=>{e.addEventListener("click",t=>{let n=e.parentNode,i=n.classList.contains("opened");d.forEach(e=>{e.parentNode.classList.remove("opened")}),i||n.classList.add("opened"),e.querySelector(".subject").classList.remove("new"),console.log(n)})})}}).init()});